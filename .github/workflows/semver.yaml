name: PR Quality & Version Preview

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  validate-and-preview:
    runs-on: ubuntu-latest
    steps:
      # 1. Valida se o t칤tulo segue o padr칚o Conventional Commits
      - name: Validate PR Title
        uses: amannn/action-semantic-pull-request@v5
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # 2. Checkout do c칩digo para analisar o hist칩rico de tags
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 3. Calcula a pr칩xima vers칚o baseada no hist칩rico e no PR atual
      - name: Predict Next Version
        id: version_preview
        run: |
          # Instalando uma ferramenta leve de Conventional Commits
          npm install -g conventional-changelog-conventionalcommits conventional-recommend-bump
          
          CURRENT_VERSION=$(git describe --tags --abbrev=0 2>/dev/null || echo "v0.0.0")
          BUMP_TYPE=$(npx conventional-recommend-bump -p conventionalcommits)
          
          echo "current_version=$CURRENT_VERSION" >> $GITHUB_OUTPUT
          echo "bump_type=$BUMP_TYPE" >> $GITHUB_OUTPUT
          
          # L칩gica simples de incremento para o coment치rio
          # Nota: Em um ambiente real, voc칡 pode usar scripts mais robustos de semver
          echo "next_version=Calculando via $BUMP_TYPE..." >> $GITHUB_OUTPUT

      # 4. Comenta no PR (ou atualiza o anterior)
      - name: Comment PR Version Preview
        uses: thollander/actions-comment-pull-request@v2
        with:
          message: |
            ### 游 Previs칚o de Release
            Baseado no t칤tulo do seu PR, a pr칩xima vers칚o ser치 um **${{ steps.version_preview.outputs.bump_type }}**.
            Vers칚o atual: `${{ steps.version_preview.outputs.current_version }}`
            
            > [!TIP]
            > Mantenha o padr칚o Conventional Commits para garantir o versionamento sem칙ntico correto.
          comment_tag: version_preview_comment
