name: Conventional Commits & SemVer

on:
  pull_request:
    types: [opened, edited, synchronize]

env:
  BASE_COMMIT: "SUBSTITUA_AQUI_PELO_HASH_DO_DIA_0"  # ex: "a1b2c3d"

jobs:
  check:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read
    
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Validar t√≠tulo do PR
        uses: amannn/action-semantic-pull-request@v5
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Calcular vers√£o prevista
        id: calc
        run: python3 scripts/ci/calculate_version.py
        env:
          BASE_COMMIT: ${{ env.BASE_COMMIT }}

      - name: Comentar vers√£o no PR
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            <!-- SEMVER_PREVIEW -->
            ## üîÆ Previs√£o de Vers√£o
            
            **Pr√≥xima vers√£o:** `v${{ steps.calc.outputs.next_version }}`
            
            | Tipo | Impacto |
            |------|---------|
            | Breaking | ${{ steps.calc.outputs.has_breaking == 'true' && '‚ö†Ô∏è Sim' || '‚úÖ N√£o' }} |
            | Features | ${{ steps.calc.outputs.has_feat == 'true' && '‚ú® Sim' || '‚úÖ N√£o' }} |
            | Fixes | ${{ steps.calc.outputs.has_fix == 'true' && 'üêõ Sim' || '‚úÖ N√£o' }} |
            
            > Refer√™ncia: `${{ env.BASE_COMMIT }}` (v0.0.0)
          edit-mode: replace
          comment-author: github-actions[bot]
          body-includes: '<!-- SEMVER_PREVIEW -->'
